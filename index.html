<!DOCTYPE html>
<html>
<head>
    <title>DMOJ local judge</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <style>
        #home-panel, #queue-panel, #problem-detail {
            display: none;
            margin: 0 1em;
        }

        nav {
            padding-bottom: 1em;
        }

        #loading {
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.25);
            z-index: 1000;
        }

        #loading div {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: url('img/load.svg');
            background-size: 100% auto;
            width: 50vmin;
            height: 50vmin;
        }
    </style>
    <script>
        var ipc = require('ipc');
        var problem_count = 0;
        ipc.on('problem-list', function (data) {
            for (var i in data) {
                $('#problem-list-body').append('<tr><td style="width:100%;vertical-align:middle">' +
                        data[i] +
                        '</td><td><button type="button" class="btn btn-default problem-detail"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span></button></td></tr>');
            }
            problem_count += data.length;
        }).on('problem-list-done', function (data) {
            $('#problem-count-badge').append(problem_count);
            $('#loading').fadeOut(500);
            window.current_tab = $('#problem-panel').fadeIn(750);
            window.current_label = $('#problem-tab').addClass('active');
            window.switch_tab = function (new_tab, label) {
                window.current_tab.fadeOut(100);
                window.current_tab = new_tab.fadeIn(100);
                if (label) {
                    window.current_label.removeClass('active');
                    window.current_label = label.addClass('active');
                }
            };

            $('#home-tab').click(function () {
                switch_tab($('#home-panel'), $('#home-tab'));
            });
            $('#problem-tab').click(function () {
                switch_tab($('#problem-panel'), $('#problem-tab'));
            });
            $('#queue-tab').click(function () {
                switch_tab($('#queue-panel'), $('#queue-tab'));
            });
            $('.problem-detail').click(function () {
                var code = $(this).parents('tr').find('td:first-child').text();
                var page = $('#problem-detail');
                page.find('h1').text(code);
                ipc.send('query-problem-data', code);
                switch_tab(page);
            })
        }).on('problem-data', function (data) {
            $('#problem-data').text(data);
        });
        var $ = require('./js/jquery.min.js');
        $(document).ready(function () {
            $('#filter').keyup(function () {
                var rex = new RegExp($(this).val(), 'i');
                $('.searchable tr').hide().filter(function () {
                    return rex.test($(this).text());
                }).show();
            });
        });
    </script>
</head>
<body>
<br/>

<nav>
<ul class="nav nav-tabs" role="tablist">
    <li id="home-tab" role="presentation"><a href="#">Home</a></li>
    <li id="problem-tab" role="presentation" class="active"><a href="#">Problems <span id="problem-count-badge"
                                                                                       class="badge"></span></a></li>
    <li id="queue-tab" role="presentation"><a href="#">Queue <span class="badge">667</span></a></li>
</ul>
</nav>

<div id="loading"><div></div></div>

<div id="problem-panel">
    <div class="container">
        <div class="panel panel-primary">
            <div class="panel-heading">Problems <button type="button" class="btn btn-default btn-xs pull-right">
                <span class="glyphicon glyphicon-refresh"></span></button></div>
            <div class="panel-body">
                <div class="input-group">
                <span class="input-group-addon" id="sizing-addon1">
                    <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                </span>
                    <input id="filter" type="text" class="form-control" placeholder="Search problems..."
                           aria-describedby="sizing-addon1">
                </div>
            </div>
            <table class="table table-hover table-striped header-fixed">
                <thead>
                <tr>
                    <th>Code</th>
                    <th></th>
                </tr>
                </thead>
                <tbody id="problem-list-body" class="searchable">
                </tbody>
            </table>
        </div>
    </div>
</div>


<div id="home-panel">
    <div class="container">
        <div class="jumbotron">
            <h1>Hello, world!</h1>

            <p>...</p>

            <p><a class="btn btn-primary btn-lg" href="#" role="button">Start judging</a></p>
        </div>
    </div>
</div>

<div id="queue-panel">
    <h1>TODO</h1>
</div>

<div id="problem-detail">
    <h1></h1>
    <pre id="problem-data"></pre>
</div>

</body>
</html>